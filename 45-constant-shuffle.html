<!doctype html>
<html>
  <head>
    <title>Idiosyncratic Ruby: Constant Shuffle</title>
    <link rel="alternate" type="application/atom+xml" title="Idiosyncratic Ruby Feed" href="/feed.xml" />
<link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />

<script src="/javascripts/jquery.min.js" type="text/javascript"></script><script src="/javascripts/app.js" type="text/javascript"></script>

<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta name="description" content="Documenting All Ruby Specialities."/>
<meta name="keywords" content="ruby, core, constants"/>

  </head>

  <body>
    <div class="world">
      <section class="post-header">
        <a href="/" class="post-logo"><img src="/images/idiosyncratic.png" alt="Idiosyncratic Ruby"></a>
        <h1 class="post-heading" id="top"><a href="/45-constant-shuffle.html">Constant Shuffle</a></h1>
      </section>

      <article class="post">
        <p>Today, another snippet from the category <em><a href="/16-changing-the-rules.html">don't try at home, might have unforseeable consequences!</a></em></p>

<p></p>

<p>Constant assignment¹ is not permanent in Ruby, so it is perfectly valid to do this:</p>

<pre><code>module A
end

class B
  def initialize
    p 42
  end
end

A, B = B, A
# warning: already initialized constant A
# warning: previous definition of A was here
# warning: already initialized constant B
# warning: previous definition of B was here
A.new  #=&gt; #&lt;B:0x00000002744008&gt;
# 42
</code></pre>

<p>¹ As a side note: There is also <a href="https://ruby-doc.org/core/Module.html#method-i-remove_const">Module#remove_const</a>, which will delete the constant, but not the module! Quoting the documentation: <em>"If that constant referred to a module, this will not change that module's name and can lead to confusion"</em></p>

<pre><code>o = Object.send(:remove_const, :Object)
Object.constants # NameError: uninitialized constant Object
o # =&gt; Object
</code></pre>

<h2 id="the-ruby-shuffle">The Ruby Shuffle</h2>

<p>Developing the swapping idea further, for maximal confusion:</p>

<pre><code>require 'stringio'
def shuffle_ruby(n=rand(50))
  mod, os, e, sio = Module, ObjectSpace, Exception, StringIO
  stderr, $stderr = $stderr, sio.new
  n.times{
    begin
      m1 = os.each_object(mod).to_a.sample
      m2 = os.each_object(mod).to_a.sample
      puts "Swap #{m1} and #{m2}"
      eval "#{m1}, #{m2} = #{m2}, #{m1}"
    rescue e
    end
  }
  $stderr = stderr
  puts "Ruby shuffled (#{n} swaps)"
end
</code></pre>


        <h2>More Idiosyncratic Ruby</h2>
        <ul>
          <li><a href="https://github.com/janlelis/idiosyncratic-ruby.com/commit/6e5232fda866ad899915fc12c120833f41990308#all_commit_comments">Please Comment on GitHub</a></li>
            <li>Next Article: <a href="/46-the-art-of-arguments.html">The Art of Arguments</a></li>
            <li>Previous Article: <a href="/44-top-level-binding.html">Top Level Binding</a></li>
        </ul>
      </article>

      <footer>
        <div class="footer-right">
          On <a href="/">Idiosyncratic Ruby</a> by <a href="https://janlelis.com">Jan Lelis</a><br>
          
          <a href="https://janlelis.com/data-protection.html">Data Protection</a>
        </div>
        About Core, Constants<br>
        Last Update: 2017-12-25
      </footer>
    </div>
    <script src="/javascripts/rainbow-custom.min.js" type="text/javascript"></script>
  </body>
</html>