<!doctype html>
<html>
  <head>
    <title>Idiosyncratic Ruby: ½ Kilo of SHA256</title>
    <link rel="alternate" type="application/atom+xml" title="Idiosyncratic Ruby Feed" href="/feed.xml" />
<link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />

<script src="/javascripts/jquery.min.js" type="text/javascript"></script><script src="/javascripts/pagemap.min.js" type="text/javascript"></script><script src="/javascripts/app.js" type="text/javascript"></script>

<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta name="description" content="Documenting All Ruby Specialities."/>
<meta name="keywords" content="ruby, golf"/>

  </head>

  <body>
    <div class="world">
      <canvas id="map"></canvas>

      <section class="post-header">
        <a href="/" class="post-logo"><img src="/images/idiosyncratic.png" alt="Idiosyncratic Ruby"></a>
        <h1 class="post-heading" id="top"><a href="/51-half-kilo-of-sha256.html">½ Kilo of SHA256</a></h1>
      </section>

      <article class="post">
        <p>How many bytes (= ASCII characters) of Ruby code does it take to generate a <a href="https://en.wikipedia.org/wiki/SHA-2#Pseudocode">SHA 256</a> hash sum of STDIN?</p>

<p></p>

<h2 id="bytes">500 Bytes¹</h2>

<pre><code>q,z=[3,2].map{|t|i=l=1;(2..330).select{i-1&lt;(l*=i)%i+=1}.map{|e|(e**t**-1*X=2**32).to_i&amp;X-=1}}
s=proc{|n,*m|a=0
m.map{|e|a^=n&gt;&gt;e|n&lt;&lt;32-e}
a}
i=$&lt;.read.b&lt;&lt;128
(i+"\0"*(56.-(w=i.size)%64)+[~-w*8].pack('Q&gt;')).gsub(/.{64}/m){w=$&amp;.unpack'N*'
y=z
64.times{|i|i&gt;15&amp;&amp;w[i]=w[i-16]+(s[v=w[i-15],7,18]^v&gt;&gt;3)+w[i-7]+(s[w[i-2],17,19]^w[i-2]&gt;&gt;10)&amp;X
f=y[7]+s[u=y[4],6,11,25]+(u&amp;y[5]^~u&amp;y[6])+q[i]+w[i]
y=[f+s[y[0],2,13,22]+(y[0]&amp;y[1]^y[0]&amp;y[2]^y[1]&amp;y[2])&amp;X]+y
y[4]=y[4]+f&amp;X}
z=z.zip(y).map{|a,b|a+b&amp;X}}
$&gt;&lt;&lt;'%.8x'*8%z
</code></pre>

<p>This is based on a submission to a (now defunct) code golf contest and there were "better" submissions, so it is possible to get the code smaller. Looking for pull requests!</p>

<p>¹ The code above actually contains 501 bytes, but you can replace <code>"\0"</code> with a real null byte</p>

<h3 id="test-script">Test Script</h3>

<p>Save the above code as <code>sha256.rb</code> and create the following test script in the same directory:</p>

<pre><code># encoding: utf-8

require "digest/sha2"
require "open3"

TEST_SCRIPT = "ruby sha256.rb"
TEST_CASES  = [
  "Idiosyncrätic Ruby",
  "\n",
  "",
  "a"*6000,
  "a"*57
]

TEST_CASES.each{ |test_case|
  expected = Digest::SHA256.hexdigest(test_case)
  actual = nil
  Open3.popen3(TEST_SCRIPT){ |in_, out,|
    in_ &lt;&lt; test_case
    in_.close
    actual = out.read
  }
  if expected == actual
    print "."
  else
    $stderr.puts "Fail:
- Expected: #{expected.inspect}
- Actual:   #{actual.inspect}
"
  end
}
</code></pre>

<h2 id="also-see">Also See</h2>

<ul>
  <li><a href="/27-golfing-basics.html">Golfing Basics</a></li>
  <li><a href="http://golf.shinh.org/">Anarchy Golf</a></li>
</ul>


        <h2>More Idiosyncratic Ruby</h2>
        <ul>
          <li><a href="https://github.com/janlelis/idiosyncratic-ruby.com/commit/7aacbecb0d33b51fd4c82779e0e6f4f71c2d8593#all_commit_comments">Please Comment on GitHub</a></li>
            <li>Next Article: <a href="/52-constant-visibility.html">Constant Visibility</a></li>
            <li>Previous Article: <a href="/50-naming-too-good.html">Naming Too Good</a></li>
        </ul>
      </article>

      <footer>
        <div class="footer-right">
          On <a href="/">Idiosyncratic Ruby</a> by <a href="https://janlelis.com">Jan Lelis</a><br>
          
          <a href="https://janlelis.com/data-protection.html">Data Protection</a>
        </div>
        About Golf<br>
        Last Update: January 05, 2017
      </footer>
    </div>
    <script src="/javascripts/rainbow-custom.min.js" type="text/javascript"></script>
  </body>
</html>