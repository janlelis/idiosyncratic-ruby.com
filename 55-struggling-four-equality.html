<!doctype html>
<html>
  <head>
    <title>Idiosyncratic Ruby: Struggling Four Equality</title>
    <link rel="alternate" type="application/atom+xml" title="Idiosyncratic Ruby Feed" href="/feed.xml" />
<link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />

<script src="/javascripts/jquery.min.js" type="text/javascript"></script><script src="/javascripts/app.js" type="text/javascript"></script>

<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta name="description" content="Documenting All Ruby Specialities."/>
<meta name="keywords" content="ruby, core, equal, types"/>

  </head>

  <body>
    <div class="world">
      <section class="post-header">
        <a href="/" class="post-logo"><img src="/images/idiosyncratic.png" alt="Idiosyncratic Ruby"></a>
        <h1 class="post-heading" id="top"><a href="/55-struggling-four-equality.html">Struggling Four Equality</a></h1>
      </section>

      <article class="post">
        <p>Another of Ruby's idiosyncrasies is equalness. It's not too complicated, but naming is an issue here.</p>

<p></p>

<h2 id="four-concepts-of-equalness">Four Concepts of Equalness</h2>

<h3 id="equal-object-identity-comparison"><code>equal?</code> Object Identity Comparison</h3>

<p>This one is easy. Two objects should be considered identical. Think: <code>x.object_id == y.object_id</code></p>

<h3 id="equality-equality"><code>==</code> Equality Equality</h3>

<p>This is the usual method to care about. Two objects should be treated the same. If the class supports the <a href="https://ruby-doc.org/core/Comparable.html"><code>&lt;=&gt;</code> spaceship comparison operator</a>, it is expected that <code>==</code> returns <code>true</code> for the same values, <code>&lt;=&gt;</code> returns <code>0</code> for.</p>

<h3 id="eql-hash-key-equality"><code>eql?</code> Hash Key Equality</h3>

<p>Normally, this is the same as <code>==</code>: <a href="https://ruby-doc.org/core/Hash.html#class-Hash-label-Hash+Keys">"â€¦<code>eql?</code> is usually aliased to the overridden <code>==</code> method"</a></p>

<p>The most important effect of the result of <code>eql?</code> is to distinguish between hash keys: <a href="https://ruby-doc.org/core/Hash.html#class-Hash-label-Hash+Keys">"Two objects refer to the same hash key when their <code>hash</code> value is identical and the two objects are <code>eql?</code> to each other"</a>. A real life example:</p>

<pre><code>1 == 1.0 # =&gt; true
1.eql?(1.0) # =&gt; false

# this means that the following will be treated as two different keys
{1: "Idiosyncratic", 1.0 "Hash"}
</code></pre>

<p>So <code>eql?</code> is a little stricter than <code>==</code>, because it will return <code>false</code> if two objects are not instances of the same class. A typical implementation looks like this:</p>

<pre><code>def eql?(other)
  instance_of?(other.class) &amp;&amp; self == other
end
</code></pre>

<h3 id="fancy-equality"><code>===</code> Fancy Equality</h3>

<p>Implicitly used for <code>case</code> statements. Usually like <code>==</code>, but can also mean that something has some kind of relationship, like being <a href="https://github.com/janlelis/sig/blob/v1.0.1/lib/sig.rb#L108-L129">some kind of a class</a>.</p>

<h2 id="equality-implementations-for-core-classes">Equality Implementations for Core Classes</h2>

<table class="table-13-29-29-X">
  <thead>
    <tr>
      <th>Class</th>
      <th><code>eql?</code></th>
      <th><code>==</code></th>
      <th><code>===</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Object</td>
      <td>Identity (like <code>equal?</code>)</td>
      <td>Same as <code>eql?</code></td>
      <td>Same as <code>==</code></td>
    </tr>
    <tr>
      <td>Symbol</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <td>Numeric</td>
      <td>Same type, same value</td>
      <td>Same value, according to <a href="https://ruby-doc.org/core/Numeric.html#method-i-3C-3D-3E">spaceship returning <code>0</code></a></td>
      <td>-</td>
    </tr>
    <tr>
      <td>String</td>
      <td>Same length, same contents</td>
      <td>If other is a String: <code>eql?</code>, else: <code>other.to_str === self</code></td>
      <td>-</td>
    </tr>
    <tr>
      <td>Regexp</td>
      <td>If other is a Regexp: Same pattern, same options, same encoding</td>
      <td>Same as <code>eql?</code></td>
      <td>If other is a String: Match against self</td>
    </tr>
    <tr>
      <td>Array</td>
      <td>Same length, every element <code>.eql?</code> corresponding other element</td>
      <td>Same length, every element <code>==</code> corresponding other element. Will <a href="/54-try-converting.html">implicitly convert</a> other object via <code>.to_ary</code></td>
      <td>-</td>
    </tr>
    <tr>
      <td>Hash</td>
      <td>Same length, every element <code>==</code> corresponding other element (order not relevant)</td>
      <td>Same as <code>eql?</code></td>
      <td>-</td>
    </tr>
    <tr>
      <td>Module</td>
      <td>-</td>
      <td>-</td>
      <td><code>other.is_a?(self)</code></td>
    </tr>
    <tr>
      <td>Class</td>
      <td>-</td>
      <td>-</td>
      <td><code>other.is_a?(self)</code></td>
    </tr>
  </tbody>
</table>

<p>Meaning of <code>-</code>: Not defined / Use <code>Object</code>'s implementation</p>

<h2 id="best-practices-for-sub-classes">Best Practices for Sub Classes</h2>

<ul>
  <li>Define a meaningful <code>==</code> which returns <code>true</code> if two objects should be considered the same</li>
  <li>Make <code>eql?</code> return the same value <code>==</code>, but also limit it to return only <code>true</code> if both object are instances of the same class</li>
  <li>Don't redefine <code>equal?</code></li>
  <li>Be creative with <code>===</code> (On a reasonable level. Other people using your code expect it to be some kind of useful relationship check)</li>
</ul>

<h2 id="also-see">Also See</h2>

<ul>
  <li><a href="https://github.com/dkubb/equalizer">equalizer: Automatically define <code>==</code> and <code>eql?</code> based on the object's instance variables</a></li>
</ul>


        <h2>More Idiosyncratic Ruby</h2>
        <ul>
          <li><a href="https://github.com/janlelis/idiosyncratic-ruby.com/commit/3fcc648f2aba9272d2418d56025b8f817ca16423#all_commit_comments">Please Comment on GitHub</a></li>
            <li>Next Article: <a href="/56-us-ascii-8bit.html">US-ASCII-8BIT</a></li>
            <li>Previous Article: <a href="/54-try-converting.html">Try Converting</a></li>
        </ul>
      </article>

      <footer>
        <div class="footer-right">
          On <a href="/">Idiosyncratic Ruby</a> by <a href="https://janlelis.com">Jan Lelis</a><br>
          Article Contributions by: Yauheni Dakuka<br>
          <a href="https://janlelis.com/data-protection.html">Data Protection</a>
        </div>
        About Core, Equal, Types<br>
        Last Update: 2018-07-09
      </footer>
    </div>
    <script src="/javascripts/rainbow-custom.min.js" type="text/javascript"></script>
  </body>
</html>