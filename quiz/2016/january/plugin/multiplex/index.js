var express=require("express"),fs=require("fs"),io=require("socket.io"),crypto=require("crypto"),app=express.createServer(),staticDir=express["static"];io=io.listen(app);var opts={port:1948,baseDir:__dirname+"/../../"};io.sockets.on("connection",function(e){e.on("slidechanged",function(t){"undefined"!=typeof t.secret&&null!=t.secret&&""!==t.secret&&createHash(t.secret)===t.socketId&&(t.secret=null,e.broadcast.emit(t.socketId,t))})}),app.configure(function(){["css","js","plugin","lib"].forEach(function(e){app.use("/"+e,staticDir(opts.baseDir+e))})}),app.get("/",function(e,t){t.writeHead(200,{"Content-Type":"text/html"}),fs.createReadStream(opts.baseDir+"/index.html").pipe(t)}),app.get("/token",function(e,t){var r=(new Date).getTime(),s=Math.floor(9999999*Math.random()),o=r.toString()+s.toString();t.send({secret:o,socketId:createHash(o)})});var createHash=function(e){var t=crypto.createCipher("blowfish",e);return t["final"]("hex")};app.listen(opts.port||null);var brown="[33m",green="[32m",reset="[0m";console.log(brown+"reveal.js:"+reset+" Multiplex running on port "+green+opts.port+reset);